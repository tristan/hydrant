{% extends "index.html" %}
{% load rooturl %}
{% load gravatar %}
{% load textutils %}

{% block extrastyle %}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}/css/dashboard.css"/>
{% endblock %}

{% block content %}
<div id="dashboard">
  <div id="col-one">
  <div id="news">
    <h1>Messages</h1>
    {% for msg in messages %}
    <div class="thing">
    <div class="title">
      {% if msg.is_job %}
      Job
      <a href="{% url job msg.job.pk %}">{{ msg.job.name }}</a>
      {% else %}
      {% if msg.is_workflow %}
      Workflow
      <a href="{% url workflow msg.workflow.pk %}">{{ msg.workflow.name }}</a>
      {% endif %}
      {% endif %}
      {{ msg.verb }}
      {% ifequal msg.fromuser.username 'system' %}
      {% else %}
      by
      <a href="#">{{ msg.fromuser.username }}</a>
      {% endifequal %}
      {{ msg.date|timesince }} ago.
    </div>
    <div class="details">
    <div class="icon">
      {% ifequal msg.fromuser.username 'system' %}
      <img src="{{ MEDIA_URL }}/img/kepler-logo-32.png" alt="system"/>
      {% else %}
      <img src="{% gravatar_url msg.fromuser 32 %}" alt="{{ msg.fromuser.username }}"/>
      {% endifequal %}
      {% ifequal msg.touser.username 'system' %}
      <img src="{{ MEDIA_URL }}/img/kepler-logo-32.png" alt="system"/>
      {% else %}
      <img src="{% gravatar_url msg.touser 32 %}" alt="{{ msg.touser.username }}"/>
      {% endifequal %}
    </div>
    <div class="status">
      {{ msg.text|truncate_to_len:230 }}
    </div>
    <div style="clear: both;"></div>
    </div>
    </div>
    {% endfor %}

    <div class="thing">
    <div class="title">
      <a href="#">trystn</a>
      commented on your job
      <a href="#">{job_name}</a>
    </div>
    <div class="details">
    <div class="icon">
       <img src="{% gravatar_url 'tristan.king@gmail.com' 32 %}" alt="{{ user.username }}"/>
    </div>
    <div class="larger-status">
      wow! that was one awesome job! filler filler filler filler filler filler
      filler filler filler filler filler filler filler filler filler filler
      filler filler filler
      OH MY GOD! IE6 YOU ARE WORTHLESS!
    </div>
    <div style="clear: both;"></div>
    </div>
    </div>

    
    
  </div>
  </div>
  <div id="col-two">
  <div id="small-jobs">
    <h1>Your Recent Jobs</h1>
    {% for job in jobs %}
    <div class="thing">
      <div class="title">
	<a href="{% url job job.id %}">{{ job.name }}</a>
	{% if job.end_date %}
	ended {{ job.end_date|timesince }} ago.
	{% else %}
	{% if job.start_date %}
	started {{ job.start_date|timesince }} ago.
	{% else %}
	{% if job.submission_date %}
	submitted {{ job.submission_date|timesince }} ago.
	{% else %}
	created {{ job.creation_date|timesince }} ago.
	{% endif %}
	{% endif %}
	{% endif %}
      </div>
      <div class="details">
      <div class="icon">
	<img src="{{ MEDIA_URL }}/img/kepler-logo-32.png" alt="kepler job"/>
	<img src="{% gravatar_url job.owner 32 %}" alt="{{ job.owner.username }}"/>
      </div>
      <div class="status">
	Status: {{ job.status }}<br/>
	{% ifequal job.status 'DONE' %}
	{% else %}
	ETA: Unknown
	{% endifequal %}
      </div>
      <div style="clear: both;"></div>
      </div>
    </div>
    {% endfor %}

{% comment %}
  <div class="thing">
  <div class="title">
    <a href="#">{jobname}</a>
    started by
    <a href="#">trystn</a>
    on
    {start_date}
  </div>
  <div class="details">
  <div class="icon">
    <img src="{{ MEDIA_URL }}/img/kepler-logo-32.png" alt="kepler job"/>
    <img src="{% gravatar_url 'tristan.king@gmail.com' 32 %}" alt="trystn"/>
  </div>
  <div class="status">
    Status: Running<br/>
    ETA: Unknown
  </div>
  <div style="clear: both;"></div>
  </div>
  </div>
{% endcomment %}
  
  </div>
  <div id="small-workflows">
    <h1>Your Workflows <a href="{% url upload_workflow %}">(upload new)</a></h1>
    {% for w in workflows %}
    <div class="thing">
      <div class="title">
	<a href="{% url workflow w.pk %}">{{ w.name }}</a>
      </div>
      <div class="details">
	<div class="icon">
	  <img src="{{ MEDIA_URL }}/img/kepler-logo-32.png" alt="kepler workflow"/>
	  <img src="{% gravatar_url w.owner 32 %}" alt="{{ w.owner.username }}"/>
	</div>
	<div class="status">
	  {{ w.description|truncate_to_len:140 }}
	</div>
	<div style="clear: both;"></div>
      </div>
    </div>
    {% endfor %}
  </div>
  </div>
  <div style="clear: both;"></div>
</div>
{% endblock %}