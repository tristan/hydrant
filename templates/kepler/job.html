{% extends "kepler/base_site.html" %}
{% load listutils %}
{% block extrahead %}
<script type="text/javascript">
function set_properties() {
    var form_data = $('id_job_properties_form');
    new Ajax.Request('{% url job_details_view job.pk %}',
            { method:'post',
              postBody:form_data.serialize(),
              onSuccess: function(transport){ append_message('Properties Saved Sucessfully', 'good'); },
              onFailure: function(){ append_message('Something went wrong...', 'bad'); }
            }
            );
}
</script>
{% endblock %}
{% block content %}
<div class="dashboard-block-container">
    <div>
    <div class="dashboard-block">
        <div class="module">
            <h2>Job Details</h2>
            <table summary="Job Details">
            <tr>
                 <th scope="row">Status</th>
                 {% ifequal job.status 'DONE' %}
                 <td style="color: green">
                 {% else %}
                 {% ifequal job.status 'ERROR' %}
                 <td style="color: red">
                 {% else %}
                 <td>
                 {% endifequal %}
                 {% endifequal %}
                 {{ job.status }}</td>
            </tr>
            <tr>
                 <th scope="row">Submission Date</th>
                 <td>{{ job.submission_date }}</td>
            </tr>
            <tr>
                 <th scope="row">Start Date</th>
                 <td>{{ job.start_date }}</td>
            </tr>
            <tr>
                 <th scope="row">End Date</th>
                 <td>{{ job.end_date }}</td>
            </tr>
            <tr>
                <th scope="row">Workflow</th>
                <td><a href="{% url workflow_view job.workflow.pk %}">{{ job.workflow }}</a></td>
            </tr>
            </table>
        </div>
    {% for output_list in outputs|split_list %}
    {% cycle '' '</div><div class="dashboard-block"><div class="module"><h2>Job Properties</h2><form id="id_job_properties_form" action="" method="post"><table id="ident_table"></table></form><div class="submit-row"><input type="submit" value="Save" name="properties" onClick="set_properties();"/></div></div>' %}
    {% for out in output_list %}
        <div class="module">
            <h2>{{ out.name }}</h2>
            <table summary="{{ out.name }}">
            <tr><td style="font-weight: normal;" scope="row">
                {% ifequal out.type 'TEXT' %}
                {{ out.content|escape|linebreaks }}
                {% endifequal %}
		{% ifequal out.type 'XML' %}
		{{ out.content }}
		{% endifequal %}
                {% ifequal out.type 'IMAGE' %}
                <center>
                    <img src="{{ out.url }}"/>
                </center>
                {% endifequal %}
                {% ifequal out.type 'FILE' %}
                <a href="{{ out.url }}">Download File</a>
                {% endifequal %}
            </td></tr>
            </table>
        </div>
    {% endfor %}
    {% endfor %}
    </div>
    </div>
</div>
<script type="text/javascript">
    Element.Methods.update('ident_table', '{{ form }}');
</script>
{% endblock %}
