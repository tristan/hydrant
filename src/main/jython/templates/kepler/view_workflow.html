{% extends "kepler/base_site.html" %}
{% load textutils %}
{% block extrastyle %}
    .annotation { position: absolute; }
    .director { position: absolute; font-size: small; font-family: sans-serif; }
    .crumbs { font-size: small; font-family: sans-serif; }
    .actor { position: absolute; font-size: small; font-family: sans-serif; }
    .compactor { position: absolute; font-size: small; font-family: sans-serif; }
    a img { border: 0; }
    .vertex { position: absolute; }
    .port { position: absolute; font-size: small; font-family: sans-serif; }

    div.small { border-width: 0px; border-spacing: 0px; border-padding: 0px; display: table; vertical-align: middle; }
    div.smalltr { border-width: 0px; border-spacing: 0px; border-padding: 0px; display: table-row; vertical-align: middle; }
    div.smalltd { border-width: 0px; border-spacing: 0px; border-padding: 0px; display: table-cell; vertical-align: middle; }

    /*.properties { visibility:hidden; position: absolute; border: 1px solid #9DA3B3; background-color: #FFFFFF; padding: 10px; left: 100px; top: 50px; z-index: 100; width: 300px; height:240px; }
*/
    .properties { visibility: hidden; position: absolute; margin: 0 auto; background-color: #FFFFFF; width: 450px; top: 100px; height: 400px; border: 1px solid #9DA3B3; padding: 10px; }

    .button { background: #7CA0C7 url({{ MEDIA_URL }}img/kepler/default-bg.gif); repeat-x scroll center bottom; border: 2px solid #5B80B2; color: white; font-weight: bold; }

    .dashboard-block-container {
        display: block;
        float: left;
        position: static;
        margin: 0pt 0pt 1em;
        padding-top: 1em;
        width: auto;
        overflow: hidden;
    }
    .dashboard-block {
        display: block;
        width: 47.5%;
        float: left;
        border: 1px solid #ffFFFF;
        margin-left: 2%
    }
    .module {
        overflow: hidden;
        border: 1px solid #CCCCCC;
        margin: 0em 0em 1em 0em;
        }
    .module h2 {
        color: #666666;
        background: #EEEEEE url({{ MEDIA_URL }}img/kepler/nav-bg.gif) repeat-x scroll left bottom;
        font-size: 11px;
        font-weight: bold;
        margin: 0pt;
        padding: 2px 5px 3px;
        text-align: left;
    }
    .module p {
        width: 95%;
        padding: 0em 8em 0em 2em;
    }
    .module table {
        width: 95%;
        padding: 1em 8em 1em 2em;
    }
    .module p.tools {
        margin: 0 0 0 0;
        padding: 2px 1em 2px 1em;
        border-top: 1px solid #CCCCCC;
        border-bottom: 1px solid #CCCCCC;
        padding
    }
    .module p a.name {
    }
    .module p a.tool {
    }
    .submit-row { padding:5px 7px; text-align:right; background:white url({{ MEDIA_URL }}img/kepler/nav-bg.gif) 0 100% repeat-x; border-top:1px solid #ccc; margin:0 0; }
    .submit-row input { margin:0 0 0 0; }
    .submit-row p { margin-top:0.3em; }
{% endblock %}
{% block extrahead %}
<script type="text/javascript" src="{{ MEDIA_URL }}js/js-graph-it.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/prototype.js"></script>
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/js-graph-it.css"/>
<script type="text/javascript">
<!--
// stolen from http://www.quirksmode.org/js/cross_dhtml.html
var DHTML = (document.getElementById || document.all || document.layers);
function get_element(name) {
    if (document.getElementById) {
        this.obj = document.getElementById(name);
        this.style = document.getElementById(name).style;
    } else if (document.all) {
        this.obj = document.all[name];
        this.style = document.all[name].style;
    } else if (document.layers) {
        this.obj = document.layers[name];
        this.style = document.layers[name];
    }
}
function set_visibility(flag, obj) {
    if (!DHTML) return;
    var x = new get_element(obj);
    x.style.visibility = (flag) ? 'visible' : 'hidden';
}

function set_properties_to_none() {
    //new Ajax.Updater('properties-div', '{% url properties workflow.pk %}__none__', { method: 'get' });
    Element.Methods.update('properties-div', '');
}

function set_properties_to_loading() {
    //new Ajax.Updater('properties-div', '{% url properties workflow.pk %}__loading__', { method: 'get' });
    Element.Methods.update('properties-div', '<table style="background: #FFF; border: 1px solid #CCC; padding: 10px; margin: 2px auto; text-align: center;"><tr><td><h1 style="text-align: center;">LOADING</h1><h3 style="text-align: center;">Please wait</h3></td></tr></table>');
}
function set_properties_to_saving() {
    //new Ajax.Updater('properties-div', '{% url properties workflow.pk %}__loading__', { method: 'get' });
    Element.Methods.update('properties-div', '<table style="background: #FFF; border: 1px solid #CCC; padding: 10px; margin: 2px auto; text-align: center;"><tr><td><h1 style="text-align: center;">SAVING</h1><h3 style="text-align: center;">Please wait</h3></td></tr></table>');
}

function set_properties(url, actor_name, doclose) {
    var form_data = $(actor_name + '_parameters_form');
    var divid = '';
    if (doclose == 1) {
        set_visibility(0, 'properties-div');
        set_properties_to_none();
    } else {
        divid = 'properties-div';
        set_properties_to_saving();
    }
    new Ajax.Updater(divid, url, {postBody:form_data.serialize()});
    update_job_submission_form();
}
function update_properties(base_url, actor_name) {
    new Ajax.Updater('properties-div', base_url + actor_name, { method: 'get' });
}

function update_job_submission_form() {
    new Ajax.Updater('parameters-form', '{% url job_form_view workflow.pk %}', { method: 'get' });
}

function update_workflow_div(url) {
    {% if editable %}
    url = url + '?editable=True';
    {% endif %}
    new Ajax.Updater('workflow-div', url, { method: 'get', onComplete: function (request){initPageObjects()}});
}
-->
</script>
{% endblock %}
{% block object-tools %}
    {% if user.is_authenticated %}
        <ul>
            {% if editable %}
            <li><a href="{% url workflow_view workflow.pk %}" class="addlink">Done</a></li>
            {% else %}
            <li><a href="{% url workflow_setup workflow.pk %}" class="addlink">Setup</a></li>
            {% endif %}
            <li><a href="{% url delete_workflow workflow.pk %}" class="xlink">Delete</a></li>
        </ul>
    {% endif %}
{% endblock %}
{% block content %}
<div class="dashboard-block-container">
    <div>
    <div class="dashboard-block">
        <div id="workflow-div" class="module">
            <h2>Workflow</h2>
                <!--<div id="workflow-div" style="display: table-cell; vertical-align: top;">
                    {#% include "kepler/workflow_canvas.html" %#}
                </div>-->
        </div>
    </div>
    <div class="dashboard-block">
        <div class="module">
            <h2>Description</h2>
            {% if editable %}
            <form id="id_workflow_description_form" action="" method="post">
                <textarea id="id_workflow_description" cols="80" rows="10" name="wf_description">{{ workflow.description }}</textarea>
            </form>
            <div class="submit-row">
                <input type="submit" value="Save"/>
            </div>
            {% else %}
            <p>{{ workflow.description }}</p>
            {% endif %}
        </div>
        <div class="module">
            <h2>Parameters</h2>
            <form id="id_job_submission_form" action="" method="post">
            <div id="parameters-form">
            {% if parameters %}
            <table>{{ parameters }}</table>
            {% else %}
                <p>Loading Parameters</p>
            {% endif %}
            </div>
            {% if not editable %}
                <div class="submit-row">
            {% if user.is_authenticated %}
                    <input type="submit" value="Run Job"/>
            {% else %}
            <ul><li>log in to enable job execution</li></ul>
            {% endif %}
                </div>
            {% endif %}
            </form>
        </div>
    </div>
</div>
<div style="position: absolute; top: 100px; width: 100%;">
<div id="properties-div" style="visibility: hidden; margin-left: auto; margin-right: auto;">
</div>
</div>
</div>
<script type="text/javascript">
<!--
    update_workflow_div("{% url model_view workflow.pk %}{% if editable %}?editable=True{% endif %}");
    update_job_submission_form();
    //set_properties_to_loading();
-->
</script>
{% endblock %}
{% block sidebar %}
{% endblock %}
